<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Интерактивная карта</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
    html, body {
        margin: 0;
        height: 100%;
        background: #1e1e1e;
        color: white;
        font-family: Arial, sans-serif;
    }

    header {
        background: #242424;
        padding: 10px 15px;
        display: flex;
        gap: 10px;
        align-items: center;
        border-bottom: 1px solid #444;
    }

    select {
        background: #333;
        color: white;
        border: 1px solid #555;
        padding: 6px;
        font-size: 16px;
        border-radius: 6px;
    }

    #map {
        width: 100%;
        height: calc(100vh - 55px);
    }

    /* Popup карточка */
    #popup {
        position: absolute;
        background: #2a2a2a;
        padding: 10px;
        border-radius: 8px;
        color: #fff;
        display: none;
        pointer-events: none;
        font-size: 14px;
        border: 1px solid #444;
        z-index: 1000;
    }
</style>
</head>

<body>

<header>
    <label>Объект:</label>
    <select id="pointSelector"></select>
</header>

<div id="popup"></div>
<div id="map"></div>

<script>
// === Точки подставляются Python-скриптом ===
const points = [
  {
    "name": "ОТ ДП №3",
    "lat": 55.61259,
    "lon": 37.676406,
    "description": "Детская площадка №3"
  },
  {
    "name": "ОТ ДП №10 Ремонт",
    "lat": 55.616221,
    "lon": 37.692349,
    "description": "Детская площадка №10\nВ настоящий момент проводится устройство детской площадки с заменой игрового оборудования"
  },
  {
    "name": "ОТ ДП №6",
    "lat": 55.607695,
    "lon": 37.682069,
    "description": "Детская площадка №6"
  },
  {
    "name": "ЗО БП ДП №1",
    "lat": 55.632691,
    "lon": 37.705633,
    "description": "Детская площадка №1 Амурский тигр"
  },
  {
    "name": "ЗО БП ДП №2",
    "lat": 55.633113,
    "lon": 37.706731,
    "description": "Детская площадка №2"
  },
  {
    "name": "ЗО БП ДП №3",
    "lat": 55.633372,
    "lon": 37.707366,
    "description": "Детсая площадка №3 Китайский городок"
  },
  {
    "name": "ЗО БП ДП №4",
    "lat": 55.632831,
    "lon": 37.707036,
    "description": "Детская площадка №4"
  },
  {
    "name": "ЗО БП ДП №5",
    "lat": 55.63448,
    "lon": 37.711259,
    "description": "Детская площадка №5 Панда"
  },
  {
    "name": "ЗО БП ДП №6",
    "lat": 55.632559,
    "lon": 37.72122,
    "description": "Детская площадка №6"
  },
  {
    "name": "ЗО БП ДП № 1",
    "lat": 55.623057,
    "lon": 37.694692,
    "description": "Детская площадка № 1 Акула"
  },
  {
    "name": "ЗО БП ДП №3",
    "lat": 55.625403,
    "lon": 37.70062,
    "description": "Детская площадка №3 Мамонт"
  },
  {
    "name": "ЗО БП ДП №4",
    "lat": 55.626393,
    "lon": 37.697459,
    "description": "Детская площадка №4"
  },
  {
    "name": "Парк БП ДП №5",
    "lat": 55.628242,
    "lon": 37.701822,
    "description": "Детская площадка №5 "
  },
  {
    "name": "Парк БП ДП №6",
    "lat": 55.627233,
    "lon": 37.70442,
    "description": "Детская площадка №6 Космос"
  },
  {
    "name": "Парк БП ДП №7",
    "lat": 55.627233,
    "lon": 37.70442,
    "description": "Детская площадка №7 Космос 2"
  },
  {
    "name": "Парк БП ДП №8",
    "lat": 55.629521,
    "lon": 37.716036,
    "description": "Детская площадка №8"
  },
  {
    "name": "Парк БП ДП №9",
    "lat": 55.627984,
    "lon": 37.718135,
    "description": "Детская площадка №9"
  },
  {
    "name": "Парк БП ДП №10",
    "lat": 55.628456,
    "lon": 37.720749,
    "description": "Детская площадка №10"
  },
  {
    "name": "Парк БП ДП №11",
    "lat": 55.628456,
    "lon": 37.720749,
    "description": "Детская площадка №11"
  },
  {
    "name": "Парк БП ДП №12",
    "lat": 55.629103,
    "lon": 37.710093,
    "description": "Детская площадка №12"
  },
  {
    "name": "Парк БП ДП №13",
    "lat": 55.629161,
    "lon": 37.709839,
    "description": "Детская площадка №13"
  },
  {
    "name": "Парк БП ДП № 1",
    "lat": 55.63308,
    "lon": 37.699715,
    "description": "Детская площадка № 1 Замок"
  },
  {
    "name": "БД ДП №1",
    "lat": 55.600053,
    "lon": 37.707492,
    "description": "Детская площадка №1"
  },
  {
    "name": "БД ДП №9",
    "lat": 55.587879,
    "lon": 37.678532,
    "description": "Детская площадка №9"
  },
  {
    "name": "БД ДП №3",
    "lat": 55.601433,
    "lon": 37.671658,
    "description": "Детская площадка №3"
  },
  {
    "name": "БД ДП №4",
    "lat": 55.589287,
    "lon": 37.676938,
    "description": "Детская площадка №4"
  },
  {
    "name": "БД ДП №5",
    "lat": 55.590044,
    "lon": 37.6784,
    "description": "Детская площадка №5"
  },
  {
    "name": "БД ДП №6",
    "lat": 55.590708,
    "lon": 37.678656,
    "description": "Детская площадка №6"
  },
  {
    "name": "БД ДП №7",
    "lat": 55.590035,
    "lon": 37.679111,
    "description": "Детская площадка №7"
  },
  {
    "name": "БД ДП №8",
    "lat": 55.587913,
    "lon": 37.679186,
    "description": "Детская площадка №8"
  }
];

// === Заполняем список ===
const selector = document.getElementById("pointSelector");
points.forEach((p, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = p.name;
    selector.appendChild(opt);
});

// === Создаём карту ===
let figData = [{
    type: "scattermapbox",
    lat: points.map(p => p.lat),
    lon: points.map(p => p.lon),
    mode: "markers",
    marker: { size: 13 },
    text: points.map(p => p.name),
    customdata: points.map(p => p.description || ""),
    hoverinfo: "none"
}];

let figLayout = {
    mapbox: {
        style: "open-street-map",
        center: { lat: points[0].lat, lon: points[0].lon },
        zoom: 14
    },
    margin: { t: 0, b: 0, l: 0, r: 0 }
};

Plotly.newPlot("map", figData, figLayout);

// === Popup ===
const mapDiv = document.getElementById("map");
const popup = document.getElementById("popup");

mapDiv.onmousemove = function(e){
    popup.style.left = e.clientX + 10 + "px";
    popup.style.top  = e.clientY + 10 + "px";
};

mapDiv.on('plotly_hover', function(data){
    const idx = data.points[0].pointIndex;
    const p = points[idx];
    popup.innerHTML = `<b>${p.name}</b><br>${p.description || ""}`;
    popup.style.display = "block";
});

mapDiv.on('plotly_unhover', function(){
    popup.style.display = "none";
});

// === Перемещение карты при выборе объекта ===
selector.addEventListener("change", (event) => {
    const p = points[event.target.value];

    Plotly.relayout("map", {
        "mapbox.center": { lat: p.lat, lon: p.lon },
        "mapbox.zoom": 16
    });
});
</script>

</body>
</html>
